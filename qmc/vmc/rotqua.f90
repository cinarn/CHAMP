      subroutine gesqua(nq,xq,yq,zq,wq)
! Written by Lubos Mitas
! Creates integration pts. and weights on a sphere for various nq:

!nq= 4
!  0.577350  0.577350  0.577350  0.250000
!  0.577350 -0.577350 -0.577350  0.250000
! -0.577350  0.577350 -0.577350  0.250000
! -0.577350 -0.577350  0.577350  0.250000
!
!nq= 6
!  1.000000  0.000000  0.000000  0.166667
! -1.000000  0.000000  0.000000  0.166667
!  0.000000  1.000000  0.000000  0.166667
!  0.000000 -1.000000  0.000000  0.166667
!  0.000000  0.000000  1.000000  0.166667
!  0.000000  0.000000 -1.000000  0.166667
!
!nq=12
!  0.000000  0.000000  1.000000  0.083333
!  0.000000  0.000000 -1.000000  0.083333
!  0.894427  0.000000  0.447214  0.083333
!  0.276393  0.850651  0.447214  0.083333
! -0.723607  0.525731  0.447214  0.083333
! -0.723607 -0.525731  0.447214  0.083333
!  0.276393 -0.850651  0.447214  0.083333
!  0.723607  0.525731 -0.447214  0.083333
! -0.276393  0.850651 -0.447214  0.083333
! -0.894427 -0.000000 -0.447214  0.083333
! -0.276393 -0.850651 -0.447214  0.083333
!  0.723607 -0.525731 -0.447214  0.083333
!
!nq=18
!  1.000000  0.000000  0.000000  0.033333
! -1.000000  0.000000  0.000000  0.033333
!  0.000000  1.000000  0.000000  0.033333
!  0.000000 -1.000000  0.000000  0.033333
!  0.000000  0.000000  1.000000  0.033333
!  0.000000  0.000000 -1.000000  0.033333
!  0.707107  0.707107  0.000000  0.066667
!  0.707107 -0.707107  0.000000  0.066667
! -0.707107  0.707107  0.000000  0.066667
! -0.707107 -0.707107  0.000000  0.066667
!  0.000000  0.707107  0.707107  0.066667
!  0.000000  0.707107 -0.707107  0.066667
!  0.000000 -0.707107  0.707107  0.066667
!  0.000000 -0.707107 -0.707107  0.066667
!  0.707107  0.000000  0.707107  0.066667
! -0.707107  0.000000  0.707107  0.066667
!  0.707107  0.000000 -0.707107  0.066667
! -0.707107  0.000000 -0.707107  0.066667
!
!nq=20
!  0.491123  0.356822  0.794654  0.050000
! -0.187592  0.577350  0.794654  0.050000
! -0.607062 -0.000000  0.794654  0.050000
! -0.187592 -0.577350  0.794654  0.050000
!  0.491123 -0.356822  0.794654  0.050000
!  0.794654  0.577350  0.187592  0.050000
! -0.303531  0.934172  0.187592  0.050000
! -0.982247 -0.000000  0.187592  0.050000
! -0.303531 -0.934172  0.187592  0.050000
!  0.794654 -0.577350  0.187592  0.050000
!  0.607062  0.000000 -0.794654  0.050000
!  0.187592  0.577350 -0.794654  0.050000
! -0.491123  0.356822 -0.794654  0.050000
! -0.491123 -0.356822 -0.794654  0.050000
!  0.187592 -0.577350 -0.794654  0.050000
!  0.982247  0.000000 -0.187592  0.050000
!  0.303531  0.934172 -0.187592  0.050000
! -0.794654  0.577350 -0.187592  0.050000
! -0.794654 -0.577350 -0.187592  0.050000
!  0.303531 -0.934172 -0.187592  0.050000
!
!nq=24
!  0.866247  0.422519  0.266635  0.041667
!  0.266635  0.422519 -0.866247  0.041667
! -0.422519  0.866247  0.266635  0.041667
! -0.422519  0.266635 -0.866247  0.041667
! -0.866247 -0.422519  0.266635  0.041667
! -0.266635 -0.422519 -0.866247  0.041667
!  0.422519 -0.866247  0.266635  0.041667
!  0.422519 -0.266635 -0.866247  0.041667
!  0.266635  0.866247  0.422519  0.041667
!  0.422519  0.866247 -0.266635  0.041667
! -0.866247  0.266635  0.422519  0.041667
! -0.866247  0.422519 -0.266635  0.041667
! -0.266635 -0.866247  0.422519  0.041667
! -0.422519 -0.866247 -0.266635  0.041667
!  0.866247 -0.266635  0.422519  0.041667
!  0.866247 -0.422519 -0.266635  0.041667
!  0.422519  0.266635  0.866247  0.041667
!  0.866247  0.266635 -0.422519  0.041667
! -0.266635  0.422519  0.866247  0.041667
! -0.266635  0.866247 -0.422519  0.041667
! -0.422519 -0.266635  0.866247  0.041667
! -0.866247 -0.266635 -0.422519  0.041667
!  0.266635 -0.422519  0.866247  0.041667
!  0.266635 -0.866247 -0.422519  0.041667
!
!nq=26
!  1.000000  0.000000  0.000000  0.047619
! -1.000000  0.000000  0.000000  0.047619
!  0.000000  1.000000  0.000000  0.047619
!  0.000000 -1.000000  0.000000  0.047619
!  0.000000  0.000000  1.000000  0.047619
!  0.000000  0.000000 -1.000000  0.047619
!  0.707107  0.707107  0.000000  0.038095
!  0.707107 -0.707107  0.000000  0.038095
! -0.707107  0.707107  0.000000  0.038095
! -0.707107 -0.707107  0.000000  0.038095
!  0.000000  0.707107  0.707107  0.038095
!  0.000000  0.707107 -0.707107  0.038095
!  0.000000 -0.707107  0.707107  0.038095
!  0.000000 -0.707107 -0.707107  0.038095
!  0.707107  0.000000  0.707107  0.038095
! -0.707107  0.000000  0.707107  0.038095
!  0.707107  0.000000 -0.707107  0.038095
! -0.707107  0.000000 -0.707107  0.038095
!  0.577350  0.577350  0.577350  0.032143
!  0.577350  0.577350 -0.577350  0.032143
!  0.577350 -0.577350  0.577350  0.032143
!  0.577350 -0.577350 -0.577350  0.032143
! -0.577350  0.577350  0.577350  0.032143
! -0.577350  0.577350 -0.577350  0.032143
! -0.577350 -0.577350  0.577350  0.032143
! -0.577350 -0.577350 -0.577350  0.032143
!
!nq=32
!  0.000000  0.000000  1.000000  0.029762
!  0.000000  0.000000 -1.000000  0.029762
!  0.894427  0.000000  0.447214  0.029762
!  0.276393  0.850651  0.447214  0.029762
! -0.723607  0.525731  0.447214  0.029762
! -0.723607 -0.525731  0.447214  0.029762
!  0.276393 -0.850651  0.447214  0.029762
!  0.723607  0.525731 -0.447214  0.029762
! -0.276393  0.850651 -0.447214  0.029762
! -0.894427 -0.000000 -0.447214  0.029762
! -0.276393 -0.850651 -0.447214  0.029762
!  0.723607 -0.525731 -0.447214  0.029762
!  0.491123  0.356822  0.794654  0.032143
! -0.187592  0.577350  0.794654  0.032143
! -0.607062 -0.000000  0.794654  0.032143
! -0.187592 -0.577350  0.794654  0.032143
!  0.491123 -0.356822  0.794654  0.032143
!  0.794654  0.577350  0.187592  0.032143
! -0.303531  0.934172  0.187592  0.032143
! -0.982247 -0.000000  0.187592  0.032143
! -0.303531 -0.934172  0.187592  0.032143
!  0.794654 -0.577350  0.187592  0.032143
!  0.607062  0.000000 -0.794654  0.032143
!  0.187592  0.577350 -0.794654  0.032143
! -0.491123  0.356822 -0.794654  0.032143
! -0.491123 -0.356822 -0.794654  0.032143
!  0.187592 -0.577350 -0.794654  0.032143
!  0.982247  0.000000 -0.187592  0.032143
!  0.303531  0.934172 -0.187592  0.032143
! -0.794654  0.577350 -0.187592  0.032143
! -0.794654 -0.577350 -0.187592  0.032143
!  0.303531 -0.934172 -0.187592  0.032143
!
!nq=50
!  1.000000  0.000000  0.000000  0.012698
! -1.000000  0.000000  0.000000  0.012698
!  0.000000  1.000000  0.000000  0.012698
!  0.000000 -1.000000  0.000000  0.012698
!  0.000000  0.000000  1.000000  0.012698
!  0.000000  0.000000 -1.000000  0.012698
!  0.707107  0.707107  0.000000  0.022575
!  0.707107 -0.707107  0.000000  0.022575
! -0.707107  0.707107  0.000000  0.022575
! -0.707107 -0.707107  0.000000  0.022575
!  0.000000  0.707107  0.707107  0.022575
!  0.000000  0.707107 -0.707107  0.022575
!  0.000000 -0.707107  0.707107  0.022575
!  0.000000 -0.707107 -0.707107  0.022575
!  0.707107  0.000000  0.707107  0.022575
! -0.707107  0.000000  0.707107  0.022575
!  0.707107  0.000000 -0.707107  0.022575
! -0.707107  0.000000 -0.707107  0.022575
!  0.577350  0.577350  0.577350  0.021094
!  0.577350  0.577350 -0.577350  0.021094
!  0.577350 -0.577350  0.577350  0.021094
!  0.577350 -0.577350 -0.577350  0.021094
! -0.577350  0.577350  0.577350  0.021094
! -0.577350  0.577350 -0.577350  0.021094
! -0.577350 -0.577350  0.577350  0.021094
! -0.577350 -0.577350 -0.577350  0.021094
!  0.301511  0.301511  0.904534  0.020173
!  0.301511  0.301511 -0.904534  0.020173
!  0.301511 -0.301511  0.904534  0.020173
!  0.301511 -0.301511 -0.904534  0.020173
! -0.301511  0.301511  0.904534  0.020173
! -0.301511  0.301511 -0.904534  0.020173
! -0.301511 -0.301511  0.904534  0.020173
! -0.301511 -0.301511 -0.904534  0.020173
!  0.301511  0.904534  0.301511  0.020173
!  0.301511  0.904534 -0.301511  0.020173
!  0.301511 -0.904534  0.301511  0.020173
!  0.301511 -0.904534 -0.301511  0.020173
! -0.301511  0.904534  0.301511  0.020173
! -0.301511  0.904534 -0.301511  0.020173
! -0.301511 -0.904534  0.301511  0.020173
! -0.301511 -0.904534 -0.301511  0.020173
!  0.904534  0.301511  0.301511  0.020173
!  0.904534  0.301511 -0.301511  0.020173
!  0.904534 -0.301511  0.301511  0.020173
!  0.904534 -0.301511 -0.301511  0.020173
! -0.904534  0.301511  0.301511  0.020173
! -0.904534  0.301511 -0.301511  0.020173
! -0.904534 -0.301511  0.301511  0.020173
! -0.904534 -0.301511 -0.301511  0.020173
!
!nq=86
!  1.000000  0.000000  0.000000  0.011544
! -1.000000  0.000000  0.000000  0.011544
!  0.000000  1.000000  0.000000  0.011544
!  0.000000 -1.000000  0.000000  0.011544
!  0.000000  0.000000  1.000000  0.011544
!  0.000000  0.000000 -1.000000  0.011544
!  0.577350  0.577350  0.577350  0.011944
!  0.577350  0.577350 -0.577350  0.011944
!  0.577350 -0.577350  0.577350  0.011944
!  0.577350 -0.577350 -0.577350  0.011944
! -0.577350  0.577350  0.577350  0.011944
! -0.577350  0.577350 -0.577350  0.011944
! -0.577350 -0.577350  0.577350  0.011944
! -0.577350 -0.577350 -0.577350  0.011944
!  0.369603  0.369603  0.852518  0.011111
!  0.369603  0.369603 -0.852518  0.011111
!  0.369603 -0.369603  0.852518  0.011111
!  0.369603 -0.369603 -0.852518  0.011111
! -0.369603  0.369603  0.852518  0.011111
! -0.369603  0.369603 -0.852518  0.011111
! -0.369603 -0.369603  0.852518  0.011111
! -0.369603 -0.369603 -0.852518  0.011111
!  0.369603  0.852518  0.369603  0.011111
!  0.369603  0.852518 -0.369603  0.011111
!  0.369603 -0.852518  0.369603  0.011111
!  0.369603 -0.852518 -0.369603  0.011111
! -0.369603  0.852518  0.369603  0.011111
! -0.369603  0.852518 -0.369603  0.011111
! -0.369603 -0.852518  0.369603  0.011111
! -0.369603 -0.852518 -0.369603  0.011111
!  0.852518  0.369603  0.369603  0.011111
!  0.852518  0.369603 -0.369603  0.011111
!  0.852518 -0.369603  0.369603  0.011111
!  0.852518 -0.369603 -0.369603  0.011111
! -0.852518  0.369603  0.369603  0.011111
! -0.852518  0.369603 -0.369603  0.011111
! -0.852518 -0.369603  0.369603  0.011111
! -0.852518 -0.369603 -0.369603  0.011111
!  0.694354  0.694354  0.189064  0.011877
!  0.694354  0.694354 -0.189064  0.011877
!  0.694354 -0.694354  0.189064  0.011877
!  0.694354 -0.694354 -0.189064  0.011877
! -0.694354  0.694354  0.189064  0.011877
! -0.694354  0.694354 -0.189064  0.011877
! -0.694354 -0.694354  0.189064  0.011877
! -0.694354 -0.694354 -0.189064  0.011877
!  0.694354  0.189064  0.694354  0.011877
!  0.694354  0.189064 -0.694354  0.011877
!  0.694354 -0.189064  0.694354  0.011877
!  0.694354 -0.189064 -0.694354  0.011877
! -0.694354  0.189064  0.694354  0.011877
! -0.694354  0.189064 -0.694354  0.011877
! -0.694354 -0.189064  0.694354  0.011877
! -0.694354 -0.189064 -0.694354  0.011877
!  0.189064  0.694354  0.694354  0.011877
!  0.189064  0.694354 -0.694354  0.011877
!  0.189064 -0.694354  0.694354  0.011877
!  0.189064 -0.694354 -0.694354  0.011877
! -0.189064  0.694354  0.694354  0.011877
! -0.189064  0.694354 -0.694354  0.011877
! -0.189064 -0.694354  0.694354  0.011877
! -0.189064 -0.694354 -0.694354  0.011877
!  0.927331  0.374243  0.000000  0.011812
!  0.927331 -0.374243  0.000000  0.011812
! -0.927331  0.374243  0.000000  0.011812
! -0.927331 -0.374243  0.000000  0.011812
!  0.927331  0.000000  0.374243  0.011812
!  0.927331  0.000000 -0.374243  0.011812
! -0.927331  0.000000  0.374243  0.011812
! -0.927331  0.000000 -0.374243  0.011812
!  0.000000  0.927331  0.374243  0.011812
!  0.000000  0.927331 -0.374243  0.011812
!  0.000000 -0.927331  0.374243  0.011812
!  0.000000 -0.927331 -0.374243  0.011812
!  0.374243  0.927331  0.000000  0.011812
!  0.374243 -0.927331  0.000000  0.011812
! -0.374243  0.927331  0.000000  0.011812
! -0.374243 -0.927331  0.000000  0.011812
!  0.374243  0.000000  0.927331  0.011812
!  0.374243  0.000000 -0.927331  0.011812
! -0.374243  0.000000  0.927331  0.011812
! -0.374243  0.000000 -0.927331  0.011812
!  0.000000  0.374243  0.927331  0.011812
!  0.000000  0.374243 -0.927331  0.011812
!  0.000000 -0.374243  0.927331  0.011812
!  0.000000 -0.374243 -0.927331  0.011812

      use dim_mod
      implicit real*8(a-h,o-z)

      parameter (ncase=10,npoint=86,ntype=4,ntypm=6)

      dimension wq(*),xq(*),yq(*),zq(*), &
     &iocta(ntype),icosa(ntype),ww(ncase,ntypm),iq(ncase), &
     &itetr(ntype),i20(ntype),i24(ntype),i86(ntypm)

! The 5 Platonic solids have 4,6,8,12,20 vertices.  Why is 8 missing?
! Of the foll. grids, only those with nq= 4, 6, 12, 20 and 24 have equal weights; those with nq= 32, 86 have approx. equal wts.
! Of the foll. grids, only those with nq= 4, 20 and 24 pts do not place a pt. at (0,0,1).
      data iq/4,6,12,18,26,32,50,24,20,86/
      data itetr/4,0,0,0/
      data iocta/6,12,8,24/
      data icosa/2,10,20,0/
      data i24/24,0,0,0/
      data i20/20,0,0,0/
      data i86/6,0,8,24,24,24/
      data pi/3.14159265359d0/

! Find closest number of points to 4,6,12,18,20,24,26,32,50,86
      icasem=1
      mindif=iabs(nq-iq(1))
      do 2 ic=2,ncase
        newmin=iabs(nq-iq(ic))
        if(mindif.gt.newmin) then
          mindif=newmin
          icasem=ic
        endif
    2 continue
      icase=icasem
      nq=iq(icase)
      write(6,'(''Number of quadrature points actually used for nonlocal pseudopotential, nquad='',i5)') nq

      do 5 ic=1,ncase
        do 5 k=1,ntypm
          ww(ic,k)=0.d0
    5 continue
      do 7 j=1,npoint
        xq(j)=0.d0
        yq(j)=0.d0
        zq(j)=0.d0
        wq(j)=0.d0
    7 continue

      ww(1,1)=1.d0/4.d0
      ww(2,1)=1.d0/6.d0
      ww(3,1)=1.d0/12.d0
      ww(4,1)=1.d0/30.d0
      ww(5,1)=1.d0/21.d0
      ww(6,1)=5.d0/168.d0
      ww(7,1)=4.d0/315.d0
      ww(3,2)=1.d0/12.d0
      ww(4,2)=1.d0/15.d0
      ww(5,2)=4.d0/105.d0
      ww(6,2)=5.d0/168.d0
      ww(7,2)=64.d0/2835.d0
      ww(5,3)=27.d0/840.d0
      ww(6,3)=27.d0/840.d0
      ww(7,3)=27.d0/1280.d0
      ww(7,4)=14641.d0/725760.d0
      ww(8,1)=1.d0/24.d0
      ww(9,1)=1.d0/20.d0
      ww(10,1)=.0115440115441d0
      ww(10,3)=.0119439090859d0
      ww(10,4)=.0111105557106d0
      ww(10,5)=.0118765012945d0
      ww(10,6)=.0118123037469d0

      jj=0
      ntypa=ntype
      if(nq.eq.86) ntypa=ntypm
      do 8 k=1,ntypa
        jmax=iocta(k)
        if(nq.eq.4) jmax=itetr(k)
        if(nq.eq.12 .or. nq.eq.32) jmax=icosa(k)
        if(nq.eq.20) jmax=i20(k)
        if(nq.eq.24) jmax=i24(k)
        if(nq.eq.86) jmax=i86(k)
        do 9 j=1,jmax
          jj=jj+1
          if(jj.le.nq) wq(jj)=ww(icase,k)
    9   continue
    8 continue

      p=1.d0/dsqrt(2.d0)
      q=1.d0/dsqrt(3.d0)
      r=1.d0/dsqrt(11.d0)
      s=3.d0/dsqrt(11.d0)

!!            4, 6, 12,18,20, 24,26, 32, 50, 86  pt
!             4, 6, 12,18,26, 32,50, 24, 20, 86  pt
      go to (10,20,130,20,20,130,20,230,130,530) icase

! tetrahedron symmetry quadrature

   10 continue ! 4-pt
      do 12 j=1,4
        xq(j)=q
        if(j.gt.2) xq(j)=-q
        yq(j)=q
        if(j.eq.2 .or. j.eq.4) yq(j)=-q
        zq(j)=q
        if(j.eq.2 .or. j.eq.3) zq(j)=-q
   12 continue
      return

! octahedron symmetry quadrature

!  20 continue ! 6, 18, 20, 26-pt
   20 continue ! 6, 18, 26, 50-pt
      ip=0
      lp=0
      si=-1.d0
      do 40 ii=1,2
          si=-si
          xq(ii)=si
          yq(2+ii)=si
          zq(4+ii)=si
          if(nq.gt.6) then
            sj=-1.d0
            do 35 jj=1,2
              sj=-sj
              ip=ip+1
              xq(6+ip)=si*p
              yq(6+ip)=sj*p
              yq(10+ip)=si*p
              zq(10+ip)=sj*p
              zq(14+ip)=si*p
              xq(14+ip)=sj*p
              if(nq.gt.18) then
                sk=-1.d0
                do 32 kk=1,2
                  sk=-sk
                  lp=lp+1
                  xq(18+lp)=si*q
                  yq(18+lp)=sj*q
                  zq(18+lp)=sk*q
                    if(nq.gt.26) then
                      xq(26+lp)=si*r
                      yq(26+lp)=sj*r
                      zq(26+lp)=sk*s
                      xq(34+lp)=si*r
                      yq(34+lp)=sj*s
                      zq(34+lp)=sk*r
                      xq(42+lp)=si*s
                      yq(42+lp)=sj*r
                      zq(42+lp)=sk*r
                    endif
   32           continue
              endif
   35       continue
          endif
   40   continue
      return

!!icosahedron symmetry quadrature 12, 24, 50-pt
! icosahedron symmetry quadrature 12, 20, 32-pt

 130  zq(1)=1.d0
      zq(2)=-1.d0
      fi0=pi/5.d0
      s5=dsqrt(5.d0)
      cstha=1.d0/s5
      sntha=2.d0/s5
      den=dsqrt(15.d0+6.d0*s5)
      csth1=(2.d0+s5)/den
      snth1=dsqrt(1.d0-csth1**2)
      csth2=1.d0/den
      snth2=dsqrt(1.d0-csth2**2)

      do 150 j=1,5
        rk2=2*dfloat(j-1)
        crk2=dcos(rk2*fi0)
        srk2=dsin(rk2*fi0)
        if(nq.ne.20) then
          xq(j+2)=sntha*crk2
          yq(j+2)=sntha*srk2
          zq(j+2)=cstha
        endif
        rk21=rk2+1.d0
        crk21=dcos(rk21*fi0)
        srk21=dsin(rk21*fi0)
        if(nq.ne.20) then
          xq(j+7)=sntha*crk21
          yq(j+7)=sntha*srk21
          zq(j+7)=-cstha
        endif
        if(nq.gt.12) then
          if(nq.eq.20) k0=0
          if(nq.eq.32) k0=12
          kk1=j+k0
          kk2=j+k0+5
          kk3=j+k0+10
          kk4=j+k0+15
          xq(kk1)=snth1*crk21
          yq(kk1)=snth1*srk21
          zq(kk1)=csth1
          xq(kk2)=snth2*crk21
          yq(kk2)=snth2*srk21
          zq(kk2)=csth2
          xq(kk3)=snth1*crk2
          yq(kk3)=snth1*srk2
          zq(kk3)=-csth1
          xq(kk4)=snth2*crk2
          yq(kk4)=snth2*srk2
          zq(kk4)=-csth2
        endif
  150 continue
      return

! 230 continue ! 32-pt
  230 continue ! 24-pt
      lq=0
      do 300 l=1,ndim
        if(l.eq.1) then
          x=.8662468181078d0
          y=.4225186537611d0
          z=.2666354015167d0
        endif
        if(l.eq.2) then
          hold=y
          y=x
          x=z
          z=hold
        endif
        if(l.eq.3) then
          hold=z
          z=y
          y=x
          x=hold
        endif
        cp=dcos(-pi/2.d0)
        sp=dsin(-pi/2.d0)
        u=cp*x-sp*z
        v=y
        w=sp*x+cp*z
        do 250 m=1,4
          fi=pi*dfloat(m-1)/2
          cf=dcos(fi)
          sf=dsin(fi)
          lq=lq+1
          xq(lq)=x*cf-y*sf
          yq(lq)=x*sf+y*cf
          zq(lq)=z
          lq=lq+1
          xq(lq)=u*cf-v*sf
          yq(lq)=u*sf+v*cf
          zq(lq)=w
  250   continue
  300 continue
      return

  530 continue ! 86-pt
      ip=0
      lp=0
      pp=.927330657151d0
      qq=.374243039090d0
      rl1=.369602846454d0
      sm1=.852518311701d0
      rl2=.694354006603d0
      sm2=.189063552885d0
      si=-1.d0
      do 440 ii=1,2
        si=-si
        xq(ii)=si
        yq(2+ii)=si
        zq(4+ii)=si
        sj=-1.d0
        do 435 jj=1,2
          sj=-sj
          ip=ip+1
          xq(62+ip)=si*pp
          yq(62+ip)=sj*qq
          xq(66+ip)=si*pp
          zq(66+ip)=sj*qq
          yq(70+ip)=si*pp
          zq(70+ip)=sj*qq
          xq(74+ip)=si*qq
          yq(74+ip)=sj*pp
          xq(78+ip)=si*qq
          zq(78+ip)=sj*pp
          yq(82+ip)=si*qq
          zq(82+ip)=sj*pp
          sk=-1.d0
          do 432 kk=1,2
            sk=-sk
            lp=lp+1
            xq(6+lp)=si*q
            yq(6+lp)=sj*q
            zq(6+lp)=sk*q
            xq(14+lp)=si*rl1
            yq(14+lp)=sj*rl1
            zq(14+lp)=sk*sm1
            xq(22+lp)=si*rl1
            yq(22+lp)=sj*sm1
            zq(22+lp)=sk*rl1
            xq(30+lp)=si*sm1
            yq(30+lp)=sj*rl1
            zq(30+lp)=sk*rl1
            xq(38+lp)=si*rl2
            yq(38+lp)=sj*rl2
            zq(38+lp)=sk*sm2
            xq(46+lp)=si*rl2
            yq(46+lp)=sj*sm2
            zq(46+lp)=sk*rl2
            xq(54+lp)=si*sm2
            yq(54+lp)=sj*rl2
            zq(54+lp)=sk*rl2
  432     continue
  435   continue
  440 continue

      return
      end
!-----------------------------------------------------------------------

      subroutine rotqua
! Written by Lubos Mitas
      use qua_mod
      implicit real*8(a-h,o-z)


    2 x1=1.d0-2.d0*rannyu(0)
      x2=1.d0-2.d0*rannyu(0)
      xsum=x1*x1+x2*x2
      if(xsum.ge.1.d0) goto 2
      xsum2=2.d0*dsqrt(dabs(1.d0-xsum))
      x1=x1*xsum2
      x2=x2*xsum2
      x3=1.d0-2.d0*xsum

      theta=dacos(x3)
      sthet=dsin(theta)
      if(sthet.lt.1.d-05) then
        cfi=1.d0
        sfi=0.d0
        x1=0.d0
        x2=0.d0
        x3=1.d0
        sthet=0.d0
       else
        cfi=x1/sthet
        sfi=x2/sthet
      endif

      yy1=x3*cfi
      yy2=x3*sfi
      yy3=-sthet
      zz1=-sfi
      zz2=cfi
      zz3=0.d0

    3 u1=rannyu(0)*2.d0-1.d0
      u2=rannyu(0)*2.d0-1.d0
      usum=u1*u1+u2*u2
      if(usum.ge.1.d0) goto 3
      uu=dsqrt(usum)
      u1=u1/uu
      u2=u2/uu
!     yu1=yy1*u1
!     yu2=yy2*u1
!     yu3=yy3*u1
!     zu1=zz1*u2
!     zu2=zz2*u2
!     zu3=zz3*u2
      y1=yy1*u1+zz1*u2
      y2=yy2*u1+zz2*u2
      y3=yy3*u1+zz3*u2
      z1=yy1*u2-zz1*u1
      z2=yy2*u2-zz2*u1
      z3=yy3*u2-zz3*u1
      do 4 iq=1,nquad
        xq(iq)=xq0(iq)*x1+yq0(iq)*y1+zq0(iq)*z1
        yq(iq)=xq0(iq)*x2+yq0(iq)*y2+zq0(iq)*z2
        zq(iq)=xq0(iq)*x3+yq0(iq)*y3+zq0(iq)*z3
    4 continue
      return
      end
!-------------------------------------------------------------------------
!From: https://people.sc.fsu.edu/~jburkardt/datasets/sphere_lebedev_rule/sphere_lebedev_rule.html
!Integration rules with 6 14 26 38 50 74 86 110 146 170 194 230 266 302 350 434 590 770 974 1202 1454 1730 2030 2354 2702 3074 3470 3890 4334 4802 5294 5810 pts
!theta, phi, w
!xi = cos ( thetai ) * sin ( phii )
!yi = sin ( thetai ) * sin ( phii )
!zi =                  cos ( phii )
!6 pt:
!   0.000000000000000    90.000000000000000     0.166666666666667
! 180.000000000000000    90.000000000000000     0.166666666666667
!  90.000000000000000    90.000000000000000     0.166666666666667
! -90.000000000000000    90.000000000000000     0.166666666666667
!  90.000000000000000     0.000000000000000     0.166666666666667
!  90.000000000000000   180.000000000000000     0.166666666666667
!14 pt:
!   0.000000000000000    90.000000000000000     0.066666666666667
! 180.000000000000000    90.000000000000000     0.066666666666667
!  90.000000000000000    90.000000000000000     0.066666666666667
! -90.000000000000000    90.000000000000000     0.066666666666667
!  90.000000000000000     0.000000000000000     0.066666666666667
!  90.000000000000000   180.000000000000000     0.066666666666667
!  45.000000000000000    54.735610317245346     0.075000000000000
!  45.000000000000000   125.264389682754654     0.075000000000000
! -45.000000000000000    54.735610317245346     0.075000000000000
! -45.000000000000000   125.264389682754654     0.075000000000000
! 135.000000000000000    54.735610317245346     0.075000000000000
! 135.000000000000000   125.264389682754654     0.075000000000000
!-135.000000000000000    54.735610317245346     0.075000000000000
!-135.000000000000000   125.264389682754654     0.075000000000000
!26 pt:
!   0.000000000000000    90.000000000000000     0.047619047619048
! 180.000000000000000    90.000000000000000     0.047619047619048
!  90.000000000000000    90.000000000000000     0.047619047619048
! -90.000000000000000    90.000000000000000     0.047619047619048
!  90.000000000000000     0.000000000000000     0.047619047619048
!  90.000000000000000   180.000000000000000     0.047619047619048
!  90.000000000000000    45.000000000000000     0.038095238095238
!  90.000000000000000   135.000000000000000     0.038095238095238
! -90.000000000000000    45.000000000000000     0.038095238095238
! -90.000000000000000   135.000000000000000     0.038095238095238
!   0.000000000000000    45.000000000000000     0.038095238095238
!   0.000000000000000   135.000000000000000     0.038095238095238
! 180.000000000000000    45.000000000000000     0.038095238095238
! 180.000000000000000   135.000000000000000     0.038095238095238
!  45.000000000000000    90.000000000000000     0.038095238095238
! -45.000000000000000    90.000000000000000     0.038095238095238
! 135.000000000000000    90.000000000000000     0.038095238095238
!-135.000000000000000    90.000000000000000     0.038095238095238
!  45.000000000000000    54.735610317245346     0.032142857142857
!  45.000000000000000   125.264389682754654     0.032142857142857
! -45.000000000000000    54.735610317245346     0.032142857142857
! -45.000000000000000   125.264389682754654     0.032142857142857
! 135.000000000000000    54.735610317245346     0.032142857142857
! 135.000000000000000   125.264389682754654     0.032142857142857
!-135.000000000000000    54.735610317245346     0.032142857142857
!-135.000000000000000   125.264389682754654     0.032142857142857
!38 pt:
!   0.000000000000000    90.000000000000000     0.009523809523810
! 180.000000000000000    90.000000000000000     0.009523809523810
!  90.000000000000000    90.000000000000000     0.009523809523810
! -90.000000000000000    90.000000000000000     0.009523809523810
!  90.000000000000000     0.000000000000000     0.009523809523810
!  90.000000000000000   180.000000000000000     0.009523809523810
!  45.000000000000000    54.735610317245346     0.032142857142857
!  45.000000000000000   125.264389682754654     0.032142857142857
! -45.000000000000000    54.735610317245346     0.032142857142857
! -45.000000000000000   125.264389682754654     0.032142857142857
! 135.000000000000000    54.735610317245346     0.032142857142857
! 135.000000000000000   125.264389682754654     0.032142857142857
!-135.000000000000000    54.735610317245346     0.032142857142857
!-135.000000000000000   125.264389682754654     0.032142857142857
!  62.632194841377327    90.000000000000000     0.028571428571429
! -62.632194841377327    90.000000000000000     0.028571428571429
! 117.367805158622687    90.000000000000000     0.028571428571429
!-117.367805158622687    90.000000000000000     0.028571428571429
!  27.367805158622673    90.000000000000000     0.028571428571429
! -27.367805158622673    90.000000000000000     0.028571428571429
! 152.632194841377355    90.000000000000000     0.028571428571429
!-152.632194841377355    90.000000000000000     0.028571428571429
!   0.000000000000000    27.367805158622673     0.028571428571429
!   0.000000000000000   152.632194841377355     0.028571428571429
! 180.000000000000000    27.367805158622673     0.028571428571429
! 180.000000000000000   152.632194841377355     0.028571428571429
!   0.000000000000000    62.632194841377327     0.028571428571429
!   0.000000000000000   117.367805158622687     0.028571428571429
! 180.000000000000000    62.632194841377327     0.028571428571429
! 180.000000000000000   117.367805158622687     0.028571428571429
!  90.000000000000000    27.367805158622673     0.028571428571429
!  90.000000000000000   152.632194841377355     0.028571428571429
! -90.000000000000000    27.367805158622673     0.028571428571429
! -90.000000000000000   152.632194841377355     0.028571428571429
!  90.000000000000000    62.632194841377327     0.028571428571429
!  90.000000000000000   117.367805158622687     0.028571428571429
! -90.000000000000000    62.632194841377327     0.028571428571429
! -90.000000000000000   117.367805158622687     0.028571428571429
!50 pt:
!   0.000000000000000    90.000000000000000     0.012698412698413
! 180.000000000000000    90.000000000000000     0.012698412698413
!  90.000000000000000    90.000000000000000     0.012698412698413
! -90.000000000000000    90.000000000000000     0.012698412698413
!  90.000000000000000     0.000000000000000     0.012698412698413
!  90.000000000000000   180.000000000000000     0.012698412698413
!  90.000000000000000    45.000000000000000     0.022574955908289
!  90.000000000000000   135.000000000000000     0.022574955908289
! -90.000000000000000    45.000000000000000     0.022574955908289
! -90.000000000000000   135.000000000000000     0.022574955908289
!   0.000000000000000    45.000000000000000     0.022574955908289
!   0.000000000000000   135.000000000000000     0.022574955908289
! 180.000000000000000    45.000000000000000     0.022574955908289
! 180.000000000000000   135.000000000000000     0.022574955908289
!  45.000000000000000    90.000000000000000     0.022574955908289
! -45.000000000000000    90.000000000000000     0.022574955908289
! 135.000000000000000    90.000000000000000     0.022574955908289
!-135.000000000000000    90.000000000000000     0.022574955908289
!  45.000000000000000    54.735610317245346     0.021093750000000
!  45.000000000000000   125.264389682754654     0.021093750000000
! -45.000000000000000    54.735610317245346     0.021093750000000
! -45.000000000000000   125.264389682754654     0.021093750000000
! 135.000000000000000    54.735610317245346     0.021093750000000
! 135.000000000000000   125.264389682754654     0.021093750000000
!-135.000000000000000    54.735610317245346     0.021093750000000
!-135.000000000000000   125.264389682754654     0.021093750000000
!  45.000000000000000    25.239401820678911     0.020173335537919
!  45.000000000000000   154.760598179321079     0.020173335537919
! -45.000000000000000    25.239401820678911     0.020173335537919
! -45.000000000000000   154.760598179321079     0.020173335537919
! 135.000000000000000    25.239401820678911     0.020173335537919
! 135.000000000000000   154.760598179321079     0.020173335537919
!-135.000000000000000    25.239401820678911     0.020173335537919
!-135.000000000000000   154.760598179321079     0.020173335537919
!  71.565051177077990    72.451599386207704     0.020173335537919
! -71.565051177077990    72.451599386207704     0.020173335537919
!  71.565051177077990   107.548400613792296     0.020173335537919
! -71.565051177077990   107.548400613792296     0.020173335537919
! 108.434948822922010    72.451599386207704     0.020173335537919
!-108.434948822922010    72.451599386207704     0.020173335537919
! 108.434948822922010   107.548400613792296     0.020173335537919
!-108.434948822922010   107.548400613792296     0.020173335537919
!  18.434948822922017    72.451599386207704     0.020173335537919
! 161.565051177078004    72.451599386207704     0.020173335537919
!  18.434948822922017   107.548400613792296     0.020173335537919
! 161.565051177078004   107.548400613792296     0.020173335537919
! -18.434948822922017    72.451599386207704     0.020173335537919
!-161.565051177078004    72.451599386207704     0.020173335537919
! -18.434948822922017   107.548400613792296     0.020173335537919
!-161.565051177078004   107.548400613792296     0.020173335537919
!74 pt:
!   0.000000000000000    90.000000000000000     0.000513067179734
! 180.000000000000000    90.000000000000000     0.000513067179734
!  90.000000000000000    90.000000000000000     0.000513067179734
! -90.000000000000000    90.000000000000000     0.000513067179734
!  90.000000000000000     0.000000000000000     0.000513067179734
!  90.000000000000000   180.000000000000000     0.000513067179734
!  90.000000000000000    45.000000000000000     0.016604069565742
!  90.000000000000000   135.000000000000000     0.016604069565742
! -90.000000000000000    45.000000000000000     0.016604069565742
! -90.000000000000000   135.000000000000000     0.016604069565742
!   0.000000000000000    45.000000000000000     0.016604069565742
!   0.000000000000000   135.000000000000000     0.016604069565742
! 180.000000000000000    45.000000000000000     0.016604069565742
! 180.000000000000000   135.000000000000000     0.016604069565742
!  45.000000000000000    90.000000000000000     0.016604069565742
! -45.000000000000000    90.000000000000000     0.016604069565742
! 135.000000000000000    90.000000000000000     0.016604069565742
!-135.000000000000000    90.000000000000000     0.016604069565742
!  45.000000000000000    54.735610317245346    -0.029586038961039
!  45.000000000000000   125.264389682754654    -0.029586038961039
! -45.000000000000000    54.735610317245346    -0.029586038961039
! -45.000000000000000   125.264389682754654    -0.029586038961039
! 135.000000000000000    54.735610317245346    -0.029586038961039
! 135.000000000000000   125.264389682754654    -0.029586038961039
!-135.000000000000000    54.735610317245346    -0.029586038961039
!-135.000000000000000   125.264389682754654    -0.029586038961039
!  45.000000000000000    42.794137107114921     0.026576207082159
!  45.000000000000000   137.205862892885108     0.026576207082159
! -45.000000000000000    42.794137107114921     0.026576207082159
! -45.000000000000000   137.205862892885108     0.026576207082159
! 135.000000000000000    42.794137107114921     0.026576207082159
! 135.000000000000000   137.205862892885108     0.026576207082159
!-135.000000000000000    42.794137107114921     0.026576207082159
!-135.000000000000000   137.205862892885108     0.026576207082159
!  56.789089239100910    61.289485196402069     0.026576207082159
! -56.789089239100910    61.289485196402069     0.026576207082159
!  56.789089239100910   118.710514803597945     0.026576207082159
! -56.789089239100910   118.710514803597945     0.026576207082159
! 123.210910760899083    61.289485196402069     0.026576207082159
!-123.210910760899083    61.289485196402069     0.026576207082159
! 123.210910760899083   118.710514803597945     0.026576207082159
!-123.210910760899083   118.710514803597945     0.026576207082159
!  33.210910760899083    61.289485196402069     0.026576207082159
! 146.789089239100917    61.289485196402069     0.026576207082159
!  33.210910760899083   118.710514803597945     0.026576207082159
! 146.789089239100917   118.710514803597945     0.026576207082159
! -33.210910760899083    61.289485196402069     0.026576207082159
!-146.789089239100917    61.289485196402069     0.026576207082159
! -33.210910760899083   118.710514803597945     0.026576207082159
!-146.789089239100917   118.710514803597945     0.026576207082159
!  71.290342151652581    90.000000000000000     0.016522170993716
! -71.290342151652581    90.000000000000000     0.016522170993716
! 108.709657848347433    90.000000000000000     0.016522170993716
!-108.709657848347433    90.000000000000000     0.016522170993716
!  18.709657848347415    90.000000000000000     0.016522170993716
! -18.709657848347415    90.000000000000000     0.016522170993716
! 161.290342151652595    90.000000000000000     0.016522170993716
!-161.290342151652595    90.000000000000000     0.016522170993716
!   0.000000000000000    18.709657848347415     0.016522170993716
!   0.000000000000000   161.290342151652595     0.016522170993716
! 180.000000000000000    18.709657848347415     0.016522170993716
! 180.000000000000000   161.290342151652595     0.016522170993716
!   0.000000000000000    71.290342151652581     0.016522170993716
!   0.000000000000000   108.709657848347433     0.016522170993716
! 180.000000000000000    71.290342151652581     0.016522170993716
! 180.000000000000000   108.709657848347433     0.016522170993716
!  90.000000000000000    18.709657848347415     0.016522170993716
!  90.000000000000000   161.290342151652595     0.016522170993716
! -90.000000000000000    18.709657848347415     0.016522170993716
! -90.000000000000000   161.290342151652595     0.016522170993716
!  90.000000000000000    71.290342151652581     0.016522170993716
!  90.000000000000000   108.709657848347433     0.016522170993716
! -90.000000000000000    71.290342151652581     0.016522170993716
! -90.000000000000000   108.709657848347433     0.016522170993716
!86 pt:
!   0.000000000000000    90.000000000000000     0.011544011544012
! 180.000000000000000    90.000000000000000     0.011544011544012
!  90.000000000000000    90.000000000000000     0.011544011544012
! -90.000000000000000    90.000000000000000     0.011544011544012
!  90.000000000000000     0.000000000000000     0.011544011544012
!  90.000000000000000   180.000000000000000     0.011544011544012
!  45.000000000000000    54.735610317245346     0.011943909085856
!  45.000000000000000   125.264389682754654     0.011943909085856
! -45.000000000000000    54.735610317245346     0.011943909085856
! -45.000000000000000   125.264389682754654     0.011943909085856
! 135.000000000000000    54.735610317245346     0.011943909085856
! 135.000000000000000   125.264389682754654     0.011943909085856
!-135.000000000000000    54.735610317245346     0.011943909085856
!-135.000000000000000   125.264389682754654     0.011943909085856
!  45.000000000000000    31.513359490876244     0.011110555710603
!  45.000000000000000   148.486640509123760     0.011110555710603
! -45.000000000000000    31.513359490876244     0.011110555710603
! -45.000000000000000   148.486640509123760     0.011110555710603
! 135.000000000000000    31.513359490876244     0.011110555710603
! 135.000000000000000   148.486640509123760     0.011110555710603
!-135.000000000000000    31.513359490876244     0.011110555710603
!-135.000000000000000   148.486640509123760     0.011110555710603
!  66.561222392026522    68.308874114180426     0.011110555710603
! -66.561222392026522    68.308874114180426     0.011110555710603
!  66.561222392026522   111.691125885819588     0.011110555710603
! -66.561222392026522   111.691125885819588     0.011110555710603
! 113.438777607973492    68.308874114180426     0.011110555710603
!-113.438777607973492    68.308874114180426     0.011110555710603
! 113.438777607973492   111.691125885819588     0.011110555710603
!-113.438777607973492   111.691125885819588     0.011110555710603
!  23.438777607973478    68.308874114180426     0.011110555710603
! 156.561222392026536    68.308874114180426     0.011110555710603
!  23.438777607973478   111.691125885819588     0.011110555710603
! 156.561222392026536   111.691125885819588     0.011110555710603
! -23.438777607973478    68.308874114180426     0.011110555710603
!-156.561222392026536    68.308874114180426     0.011110555710603
! -23.438777607973478   111.691125885819588     0.011110555710603
!-156.561222392026536   111.691125885819588     0.011110555710603
!  45.000000000000000    79.101860732695940     0.011876501294537
!  45.000000000000000   100.898139267304060     0.011876501294537
! -45.000000000000000    79.101860732695940     0.011876501294537
! -45.000000000000000   100.898139267304060     0.011876501294537
! 135.000000000000000    79.101860732695940     0.011876501294537
! 135.000000000000000   100.898139267304060     0.011876501294537
!-135.000000000000000    79.101860732695940     0.011876501294537
!-135.000000000000000   100.898139267304060     0.011876501294537
!  15.231635441931418    46.024237785326378     0.011876501294537
! -15.231635441931418    46.024237785326378     0.011876501294537
!  15.231635441931418   133.975762214673637     0.011876501294537
! -15.231635441931418   133.975762214673637     0.011876501294537
! 164.768364558068583    46.024237785326378     0.011876501294537
!-164.768364558068583    46.024237785326378     0.011876501294537
! 164.768364558068583   133.975762214673637     0.011876501294537
!-164.768364558068583   133.975762214673637     0.011876501294537
!  74.768364558068569    46.024237785326378     0.011876501294537
! 105.231635441931431    46.024237785326378     0.011876501294537
!  74.768364558068569   133.975762214673637     0.011876501294537
! 105.231635441931431   133.975762214673637     0.011876501294537
! -74.768364558068569    46.024237785326378     0.011876501294537
!-105.231635441931431    46.024237785326378     0.011876501294537
! -74.768364558068569   133.975762214673637     0.011876501294537
!-105.231635441931431   133.975762214673637     0.011876501294537
!  68.022464238570777    90.000000000000000     0.011812303746904
! -68.022464238570777    90.000000000000000     0.011812303746904
! 111.977535761429237    90.000000000000000     0.011812303746904
!-111.977535761429237    90.000000000000000     0.011812303746904
!  21.977535761429227    90.000000000000000     0.011812303746904
! -21.977535761429227    90.000000000000000     0.011812303746904
! 158.022464238570763    90.000000000000000     0.011812303746904
!-158.022464238570763    90.000000000000000     0.011812303746904
!   0.000000000000000    21.977535761429227     0.011812303746904
!   0.000000000000000   158.022464238570763     0.011812303746904
! 180.000000000000000    21.977535761429227     0.011812303746904
! 180.000000000000000   158.022464238570763     0.011812303746904
!   0.000000000000000    68.022464238570777     0.011812303746904
!   0.000000000000000   111.977535761429237     0.011812303746904
! 180.000000000000000    68.022464238570777     0.011812303746904
! 180.000000000000000   111.977535761429237     0.011812303746904
!  90.000000000000000    21.977535761429227     0.011812303746904
!  90.000000000000000   158.022464238570763     0.011812303746904
! -90.000000000000000    21.977535761429227     0.011812303746904
! -90.000000000000000   158.022464238570763     0.011812303746904
!  90.000000000000000    68.022464238570777     0.011812303746904
!  90.000000000000000   111.977535761429237     0.011812303746904
! -90.000000000000000    68.022464238570777     0.011812303746904
! -90.000000000000000   111.977535761429237     0.011812303746904
